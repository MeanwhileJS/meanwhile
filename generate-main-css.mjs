import fs from 'fs-extra';
import path from 'path';
import glob from 'glob';
import { fileURLToPath } from 'url';
import { dirname } from 'path';

// Get the current file path and directory name
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Define the output directory and the path to the main CSS file
const outputDir = path.resolve(__dirname, 'dist');
const mainCssPath = path.join(outputDir, 'main.css');

// Find all CSS files generated by Webpack (assuming they are in the 'dist' directory)
glob(`${outputDir}/**/*.css`, (err, files) => {
  if (err) {
    console.error('Error finding CSS files', err);
    return;
  }

  // Generate the @import statements for each CSS file
  const imports = files
    .map((file) => `@import url('${path.basename(file)}');`)
    .join('\n');
  
  fs.ensureFile(mainCssPath).then(() => {
    // Write the main.css file with all the @import statements
    fs.writeFileSync(mainCssPath, imports);
    console.log(`Generated ${mainCssPath} with the following imports:\n${imports}`);
  })
});
